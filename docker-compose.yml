services:
  otp:
    image: opentripplanner/opentripplanner:2.8.1
    container_name: otp
    environment:
      - JAVA_TOOL_OPTIONS=-Xms8G -Xmx12G
    deploy:
      resources:
        limits:
          memory: 16G
    volumes:
      - ./otp:/var/opentripplanner
    command: ["--load", "--serve"]
    networks:
      - isochrone-internal

  backend-java:
    build:
      context: ./backend-java
      dockerfile: Dockerfile
    container_name: backend-java
    environment:
      - OTP_API_BASE_URL=http://otp:8080/otp
      - SPRING_PROFILES_ACTIVE=default
    depends_on:
      - otp
    networks:
      - isochrone-internal

networks:
  isochrone-internal:
    driver: bridge
    name: isochrone-internal
