services:
  otp:
    image: opentripplanner/opentripplanner:2.5.0
    container_name: otp
    environment:
      - JAVA_TOOL_OPTIONS=-Xms8G -Xmx12G
    deploy:
      resources:
        limits:
          memory: 16G
    volumes:
      - ./otp:/var/opentripplanner
    command: ["--load", "--serve"]
    networks:
      - isochrone-internal

  backend-java-springboot:
    build:
      context: ./backend-java-springboot
      dockerfile: Dockerfile
    container_name: backend-java-springboot
    environment:
      - OTP_API_BASE_URL=http://otp:8080/otp
      - SPRING_PROFILES_ACTIVE=default
    depends_on:
      - otp
    networks:
      - isochrone-internal

  backend-python-fastapi:
    build:
      context: ./backend-python-fastapi
      dockerfile: Dockerfile
    container_name: backend-python-fastapi
    environment:
      - OTP_API_BASE_URL=http://otp:8080/otp
      - ISOCHRONE_REQUEST_TIMEOUT=15
      - ISOCHRONE_REQUEST_RETRIES=3
    depends_on:
      - otp
    networks:
      - isochrone-internal

  frontend-vue3:
    build:
      context: ./frontend-vue3
      dockerfile: Dockerfile
      args:
        VITE_API_BASE_URL: ${VITE_API_BASE_URL:-http://backend-python-fastapi:8000}
        VITE_KAKAO_REST_API_KEY: ${VITE_KAKAO_REST_API_KEY:-}
        VITE_KAKAO_JS_KEY: ${VITE_KAKAO_JS_KEY:-}
    container_name: frontend-vue3
    depends_on:
      - backend-python-fastapi
    networks:
      - isochrone-internal

networks:
  isochrone-internal:
    driver: bridge
    name: isochrone-internal
